pipelines: 

## Using NpmBuild step will fail due to issue https://jira.jfrog.org/browse/RTDEV-25641

  - name: npm_app_pipeline
    steps: 
  #     - name: npm_build_install
  #       type: NpmBuild
  #       configuration:
  #         resolverRepo: pe-npm
  #         sourceLocation: .
  #         integrations:
  #           - name: artifactory
  #         inputResources:
  #           - name: pe_source_code
   
  #     - name: npm_build_publish
  #       type: NpmPublish
  #       configuration:
  #         deployerRepo: pe-npm-local
  #         integrations:
  #           - name: artifactory
  #         inputSteps:
  #           - name: npm_build_install
  #         outputResources:
  #           - name: npm_app_build_info
   
      - name: bash_npm_build_publish
        type: Bash
        configuration: 
          runtime:
            type: host
          environmentVariables: 
            readOnly:
              JFROG_CLI_BUILD_NAME: bash_npm_build_publish
              JFROG_CLI_BUILD_NUMBER: "1.0.${run_number}"
            appVersion: "1.0.${run_number}"
          integrations: 
            - name: artifactory
            - name: pegeneric
          inputResources:
            - name: pe_source_code
          outputResources: 
            - name: npm_app_build_info
        execution: 
          onExecute: 
            - printenv int_pegeneric_user
            - printenv int_pegeneric_password
            - printenv int_pegeneric_server
            - git clone https://github.com/davidpinhas/simple-reactjs-app.git
            - cd simple-reactjs-app
            - jfrog config add $int_pegeneric_server --artifactory-url https://$int_pegeneric_server.jfrog.io/artifactory --user $int_pegeneric_user --password $int_pegeneric_password --interactive=false
            - jfrog rt npm-config --server-id-resolve $int_pegeneric_server --server-id-deploy $int_pegeneric_server --repo-resolve pe-npm-remote --repo-deploy pe-npm-local
            - jfrog rt npmi --build-name=npm-app --build-number=1.0.${run_number}
            - jfrog rt bag npm-app 1.0.${run_number}
            - jfrog rt bce npm-app 1.0.${run_number}
            - jfrog rt bp npm-app 1.0.${run_number}

      - name: npm_publish_buildinfo
        type: PublishBuildInfo
        configuration:
          inputSteps:
            - name: bash_npm_build_publish
          outputResources:
            - name: npm_app_build_info


      - name: npm_app_scan
        type: XrayScan
        configuration:
          failOnScan: false
          inputSteps:
            - name: npm_publish_buildinfo
          inputResources:
            - name: npm_app_build_info
